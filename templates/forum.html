{% extends 'base.html' %}

{% block title %}VFORUM - Comunidad EEVI{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/forum_modern.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<header class="forum-header">
    <div class="header-content">
        <div class="logo">VFORUM</div>
        
        <div class="search-container">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" placeholder="Buscar en el foro..." id="forumSearch">
        </div>
        
        <div class="header-actions">
            <a href="{{ url_for('client.home') }}" class="btn btn-secondary">Inicio</a>
            <a href="{{ url_for('forum_new') }}" class="btn">+ Nuevo Tema</a>
        </div>
    </div>
</header>

<div class="forum-container">
    <!-- Left Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">Categor√≠as</h3>
            <ul class="category-list">
                <li class="category-item">
                    <a href="{{ url_for('list_forum') }}" class="category-link {{ 'active' if not request.args.get('category') else '' }}">
                        <span class="category-icon">üéµ</span>
                        Todas las categor√≠as
                    </a>
                </li>
                {% for category in categories %}
                <li class="category-item">
                    <a href="{{ url_for('list_forum') }}?category={{ category|urlencode }}" 
                       class="category-link {{ 'active' if request.args.get('category') == category else '' }}">
                        <span class="category-icon">
                            {% if 'Grabaci√≥n' in category %}üé§
                            {% elif 'Dise√±o' in category %}üé®
                            {% elif 'Foley' in category %}üîä
                            {% elif 'v√≠deo' in category %}üé¨
                            {% elif 'audio' in category and 'Edici√≥n' in category %}üéß
                            {% elif 'Mezcla' in category %}‚ö°
                            {% elif 'Micr√≥fonos' in category %}üéôÔ∏è
                            {% elif 'Workflows' in category %}üîß
                            {% elif 'Ambientes' in category %}üå≤
                            {% elif 'Postproducci√≥n' in category %}üéûÔ∏è
                            {% elif 'Formatos' in category %}üìÑ
                            {% elif 'Consejos' in category %}üí°
                            {% else %}üéµ{% endif %}
                        </span>
                        {{ category }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="sidebar-section">
            <h3 class="sidebar-title">Filtros</h3>
            <ul class="category-list">
                <li class="category-item">
                    <a href="{{ url_for('list_forum') }}?filter=trending" class="category-link">
                        <span class="category-icon">üî•</span>
                        Tendencias
                    </a>
                </li>
                <li class="category-item">
                    <a href="{{ url_for('list_forum') }}?filter=pinned" class="category-link">
                        <span class="category-icon">üìå</span>
                        Fijados
                    </a>
                </li>
                <li class="category-item">
                    <a href="{{ url_for('list_forum') }}?filter=unanswered" class="category-link">
                        <span class="category-icon">‚ùì</span>
                        Sin responder
                    </a>
                </li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-header">
            <h1 class="page-title">Discusiones</h1>
            <div class="filter-tabs">
                <button class="filter-tab {{ 'active' if not request.args.get('sort') or request.args.get('sort') == 'recent' else '' }}" 
                        data-sort="recent">Recientes</button>
                <button class="filter-tab {{ 'active' if request.args.get('sort') == 'popular' else '' }}" 
                        data-sort="popular">Populares</button>
                <button class="filter-tab {{ 'active' if request.args.get('sort') == 'unanswered' else '' }}" 
                        data-sort="unanswered">Sin resolver</button>
            </div>
        </div>

        <div class="topics-list">
            {% for topic in topics %}
            <div class="topic-card" onclick="window.location.href='{{ url_for('forum_topic_view', topic_id=topic.id) }}'">
                <div class="topic-header">
                    <div class="topic-avatar">{{ topic.author[0].upper() if topic.author else 'A' }}</div>
                    <div class="topic-info">
                        <h3 class="topic-title">{{ topic.title }}</h3>
                        <div class="topic-meta">
                            {% if topic.category %}
                            <span class="topic-category">{{ topic.category }}</span>
                            <span>‚Ä¢</span>
                            {% endif %}
                            <span>Por {{ topic.author or 'An√≥nimo' }}</span>
                            <span>‚Ä¢</span>
                            <span>{{ topic.created_at.strftime('%d %b') if topic.created_at else 'Fecha' }}</span>
                        </div>
                    </div>
                    <div class="topic-stats">
                        <div class="stat-item">
                            <span>üí¨</span>
                            <span>{{ topic.responses|length if topic.responses else 0 }}</span>
                        </div>
                        <div class="stat-item">
                            <span>üëç</span>
                            <span>{{ topic.votes or 0 }}</span>
                        </div>
                        <div class="stat-item">
                            <span>üëÅÔ∏è</span>
                            <span>{{ (topic.votes or 0) * 10 + (topic.responses|length if topic.responses else 0) * 5 + 20 }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="topic-card">
                <div class="topic-header">
                    <div class="topic-avatar">üéµ</div>
                    <div class="topic-info">
                        <h3 class="topic-title">¬°S√© el primero en crear un tema!</h3>
                        <div class="topic-meta">
                            <span class="topic-category">Bienvenida</span>
                            <span>‚Ä¢</span>
                            <span>La comunidad te espera</span>
                        </div>
                    </div>
                    <div class="topic-stats">
                        <div class="stat-item">
                            <span>üí¨</span>
                            <span>0</span>
                        </div>
                        <div class="stat-item">
                            <span>üëç</span>
                            <span>0</span>
                        </div>
                        <div class="stat-item">
                            <span>üëÅÔ∏è</span>
                            <span>1</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <!-- Right Sidebar -->
    <aside class="right-sidebar">
        <div class="widget">
            <h3 class="widget-title">
                <span>üü¢</span>
                Usuarios Activos
            </h3>
            <div class="online-users">
                <div class="user-item">
                    <div class="user-avatar"></div>
                    <span class="user-name">VeriteStudio</span>
                    <div class="online-indicator"></div>
                </div>
                <div class="user-item">
                    <div class="user-avatar"></div>
                    <span class="user-name">AudioMaster</span>
                    <div class="online-indicator"></div>
                </div>
                <div class="user-item">
                    <div class="user-avatar"></div>
                    <span class="user-name">SoundHunter</span>
                    <div class="online-indicator"></div>
                </div>
                <div class="user-item">
                    <div class="user-avatar"></div>
                    <span class="user-name">FoleyArtist</span>
                    <div class="online-indicator"></div>
                </div>
            </div>
        </div>

        <div class="widget">
            <h3 class="widget-title">
                <span>üìà</span>
                Tendencias
            </h3>
            <div class="recent-topics">
                {% for topic in topics[:3] %}
                <div class="recent-topic" onclick="window.location.href='{{ url_for('forum_topic_view', topic_id=topic.id) }}'">
                    <div class="recent-topic-title">{{ topic.title[:40] }}{{ '...' if topic.title|length > 40 else '' }}</div>
                    <div class="recent-topic-meta">{{ (topic.votes or 0) * 10 + 20 }} vistas ‚Ä¢ {{ topic.responses|length if topic.responses else 0 }} respuestas</div>
                </div>
                {% else %}
                <div class="recent-topic">
                    <div class="recent-topic-title">Field recording con smartphone</div>
                    <div class="recent-topic-meta">134 vistas ‚Ä¢ 8 respuestas</div>
                </div>
                <div class="recent-topic">
                    <div class="recent-topic-title">Plugins gratuitos imprescindibles</div>
                    <div class="recent-topic-meta">89 vistas ‚Ä¢ 12 respuestas</div>
                </div>
                <div class="recent-topic">
                    <div class="recent-topic-title">Masterizaci√≥n para streaming</div>
                    <div class="recent-topic-meta">156 vistas ‚Ä¢ 6 respuestas</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="widget">
            <h3 class="widget-title">
                <span>‚ÑπÔ∏è</span>
                Estad√≠sticas
            </h3>
            <div style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">
                <div style="margin-bottom: var(--space-1);"><strong>{{ topics|length }}</strong> temas totales</div>
                <div style="margin-bottom: var(--space-1);"><strong>{{ topics|sum(attribute='responses')|length if topics else 0 }}</strong> respuestas</div>
                <div style="margin-bottom: var(--space-1);"><strong>89</strong> miembros activos</div>
                <div><strong>12</strong> conectados ahora</div>
            </div>
        </div>
    </aside>
</div>

<!-- Floating Action Button -->
<button class="fab" title="Crear nuevo tema" onclick="window.location.href='{{ url_for('forum_new') }}'">
    ‚úèÔ∏è
</button>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/forum_modern.js') }}"></script>
{% endblock %}
