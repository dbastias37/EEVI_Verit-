{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
  {% if not user %}
  <div class="dashboard-login">
    <a href="{{ url_for('signup') }}" class="btn">Crear usuario</a>
    <a href="{{ url_for('dashboard_login') }}" class="btn">Log in</a>
  </div>
  {% else %}
  <div class="dashboard-header">
    <h2>Bienvenido, {{ user.email }}</h2>
    <button id="theme-toggle">Modo</button>
    <form action="{{ url_for('logout') }}" method="post" style="display:inline;">
      <button type="submit">Salir</button>
    </form>
  </div>

  <div class="stats">
    <div class="stat-card"><span class="stat-icon">🎬</span> {{ stats.active }} Activos</div>
    <div class="stat-card"><span class="stat-icon">🎞️</span> {{ stats.completed }} Terminados</div>
    <div class="stat-card"><span class="stat-icon">📽️</span> {{ stats.scripts }} Guiones</div>
    <div class="stat-card"><span class="stat-icon">💾</span> {{ stats.pending }} Pagos</div>
  </div>

  <h3>Proyectos Activos</h3>
  <div class="projects">
    {% for p in active_projects %}
    <div class="project-card">
      <h4>{{ p.title }}</h4>
      <div class="progress">
        <div class="progress-bar" style="width: {{ p.progress * 100 }}%"></div>
      </div>
      <iframe class="video-preview" src="{{ p.video_url }}" allow="autoplay" allowfullscreen></iframe>
      {% if not p.paid %}<button class="pay-btn">Pagar 50% restante</button>{% endif %}
    </div>
    {% endfor %}
  </div>

  <h3>Proyectos Terminados</h3>
  <div class="projects">
    {% for p in completed_projects %}
    <div class="project-card">
      <h4>{{ p.title }}</h4>
      <a href="{{ p.download }}">Descargar</a>
    </div>
    {% endfor %}
  </div>

  <h3>Biblioteca de Guiones</h3>
  <ul class="scripts-list">
    {% for p in projects %}
    <li><button class="script-btn" data-script="{{ p.script|escape }}">{{ p.title }}</button></li>
    {% endfor %}
  </ul>

  <div class="profile">
    <h3>Perfil de Usuario</h3>
    <img src="{{ user.profile_pic or '/static/img/pack1.jpg' }}" alt="Foto" class="profile-pic">
    <form action="{{ url_for('upload_profile') }}" method="post" enctype="multipart/form-data">
      <input type="file" name="photo" accept="image/*" required>
      <button type="submit">Actualizar foto</button>
    </form>
  </div>

  <div id="script-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <pre id="script-text"></pre>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/dashboard.js"></script>
{% endblock %}
