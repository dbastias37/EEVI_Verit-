{% extends 'base.html' %}
{% block title %}Panel Admin{% endblock %}
{% block content %}
<div class="dashboard-container">
  <div class="dashboard-header">
    <h2>Panel Admin</h2>
    <form action="{{ url_for('admin.admin_logout') }}" method="post" class="inline-form">
      <button type="submit">Salir</button>
    </form>
  </div>
  <div class="dashboard-login mb-1">
    <form action="{{ url_for('admin.admin_add_project') }}" method="post">
      <input type="text" name="title" placeholder="Título" required class="full-input">
      <input type="text" name="category" placeholder="Categoría" required class="full-input">
      <input type="text" name="video_url" placeholder="URL" required class="full-input">
      <input type="email" name="client_email" placeholder="Cliente" required class="full-input">
      <button type="submit">Agregar</button>
    </form>
  </div>
  <div class="projects">
    {% for p in projects %}
    <div class="project-card">
      <h4>{{ p.title }}</h4>
      <form action="{{ url_for('admin.admin_update_project', project_id=p.id) }}" method="post">
        <input type="text" name="video_url" value="{{ p.video_url }}" placeholder="URL de video" class="full-input">
        <input type="email" name="client_email" value="{{ p.client_email }}" placeholder="Cliente" class="full-input">
        <button type="submit">Guardar</button>
      </form>
      <form action="{{ url_for('admin.admin_activate_payment', project_id=p.id) }}" method="post" class="mt-half">
        {% if not p.paid %}
        <button type="submit" class="pay-btn">Activar 50%</button>
        {% else %}
        <span>Pago activado</span>
        {% endif %}
      </form>
      <form action="{{ url_for('admin.admin_delete_video', project_id=p.id) }}" method="post" onsubmit="return confirmDelete();" class="mt-half">
        <button type="submit">Eliminar Video</button>
      </form>
    </div>
    {% endfor %}
  </div>
  <h3>Comentarios recientes</h3>
  <ul class="comments-admin">
    {% for c in comments %}
    <li><strong>{{ c.user_email }}</strong> en <em>{{ c.project }}</em>: {{ c.text }} <span class="date">{{ c.date }}</span></li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
{% block scripts %}
<script>
function confirmDelete(){
  if(!confirm('¿Seguro que quieres eliminar el video?')) return false;
  const key=prompt('Escribe "eliminar 2025" para confirmar');
  if(key!=='eliminar 2025'){alert('Clave incorrecta');return false;}
  return true;
}
</script>
{% endblock %}
