{% extends 'base.html' %}


{% block head_admin %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_modern.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <aside class="sidebar">
    <nav>
      <a href="{{ url_for('admin.admin') }}" class="{% if request.endpoint == 'admin.admin' %}active{% endif %}">Dashboard</a>
      <a href="{{ url_for('admin.admin') }}">Proyectos</a>
      <a href="{{ url_for('admin.admin_clients') }}">Clientes</a>
      <a href="{{ url_for('admin.admin_users') }}">Usuarios</a>
      <a href="{{ url_for('admin.admin_comments') }}">Comentarios</a>
    </nav>
  </aside>
  <main class="main-content">
    <header class="page-header">
      <h2>Panel Admin</h2>
      <form action="{{ url_for('admin.admin_logout') }}" method="post">
        <button type="submit" class="btn-danger">Salir</button>
      </form>
    </header>

  {% set stat_items = [
     ('Proyectos',         stats.total),
     ('Activos',           stats.active),
     ('Completados',       stats.completed),
     ('Pendientes',        stats.pending)
  ] %}
  <div class="stats-grid">
    {% for label, value in stat_items %}
      <div class="stat-card">
          <div class="stat-value">{{ value }}</div>
          <div class="stat-label">{{ label }}</div>
      </div>
    {% endfor %}
  </div>

    <form class="project-form" action="{{ url_for('admin.admin_add_project') }}" method="post">
      <input type="text" name="title" placeholder="Título" required>
      <input type="text" name="category" placeholder="Categoría" required>
      <input type="text" name="video_url" placeholder="URL" required>
      <input type="email" name="client_email" placeholder="Cliente" required>
      <button type="submit">Agregar</button>
    </form>

    {% for p in projects %}
      <div class="project-card">
        <h4>{{ p.title }}</h4>
        <form action="{{ url_for('admin.admin_update_project', project_id=p.id) }}" method="post">
          <input type="text" name="video_url" value="{{ p.video_url }}" placeholder="URL de video">
          <input type="email" name="client_email" value="{{ p.client_email }}" placeholder="Cliente">
          <button type="submit">Guardar</button>
        </form>
        <form action="{{ url_for('admin.admin_activate_payment', project_id=p.id) }}" method="post">
          {% if not p.paid %}
          <button type="submit" class="btn-success">Activar 50%</button>
          {% else %}
          <span>Pago activado</span>
          {% endif %}
        </form>
        <form action="{{ url_for('admin.admin_delete_video', project_id=p.id) }}" method="post" onsubmit="return confirmDelete();">
          <button type="submit" class="btn-danger">Eliminar Video</button>
        </form>
      </div>
    {% endfor %}

    <h3>Comentarios recientes</h3>
    {% for c in comments %}
      <div class="comment-item">
        <strong>{{ c.user_email }}</strong> en <em>{{ c.project }}</em>: {{ c.text }}
        <span class="date">{{ c.date }}</span>
      </div>
    {% endfor %}
  </main>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<script>
function confirmDelete(){
  if(!confirm('¿Seguro que quieres eliminar el video?')) return false;
  const key=prompt('Escribe "eliminar 2025" para confirmar');
  if(key!=='eliminar 2025'){alert('Clave incorrecta');return false;}
  return true;
}
</script>
{% endblock %}
